{% extends 'pages/richtextpage.html' %}
{% load leaflet_tags %}
{% load mezzanine_tags %}

{% block extra_head %} {{ block.super }}
    {% leaflet_js %}
    {% leaflet_css %}
{% endblock %}

{% block main %}

    <div id="map">
        {% leaflet_map "citymap" %}
    </div>


    <div id="map-data" class="row">

        <div class="span3" id="poi-sidebar">
            {% if selected_poi %}
                <strong>{{ selected_poi.name }}</strong>
            {% else %}
                <strong>Cliquez sur un point pour voir les d√©tails</strong>
            {% endif %}
        </div>

        <div class="span6"id="poi-main">
            {% if selected_poi %}
                {{ selected_poi.description|richtext_filter|safe }}
            {% else %}
                {{ page.richtextpage.content|richtext_filter|safe }}
            {% endif %}
        </div>
    </div>

{% endblock %}

{% block extra_js %} {{ block.super }}
<script src="{{ STATIC_URL }}js/underscore.js"></script>
<script src="{{ STATIC_URL }}js/backbone.js"></script>
<script src="{{ STATIC_URL }}js/map/app.js"></script>
<script type="text/template" id="poi-sidebar-template">
    <dl>
        <dt>Lat:</dt>
        <dd><%= lat %></dd>
        <dt>Lng:</dt>
        <dd><%= lng %></dd>
    </dl>
</script>
<script type="text/javascript">
App.Config = {
    markerCollectionUrl: "{% url 'markers_data' %}",
    mapUrl: "{% url 'map' %}"
};
function citymapInit(map, bounds) {
    App.start(map);
}
</script>
{% endblock %}
